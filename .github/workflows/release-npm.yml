#
# GitHub Actions workflow.
#
# Perfoms the following actions on a pull request:
# * Pull the code
# * Release to NPM
#

name: Release Package

on:
    pull_request:
    workflow_dispatch:
    workflow_call:

jobs:
    release_package:
        name: 'Release Package'
        if: ${{ !contains(github.event.head_commit.message, '#skip-release') }}
        runs-on: ubuntu-latest

        steps:
            -   name: 'Checkout'
                uses: actions/checkout@v4
                with:
                    token: ${{ secrets.GH_PAT_TOKEN }}

            -   name: 'Install Node.js'
                uses: actions/setup-node@v4
                with:
                    node-version: latest

            -   name: 'Install dependencies'
                run: npm install

            -  name: 'Build'
               run: npm run build

            -   name: 'Authenticate with NPM'
                run: echo -e "//registry.npmjs.org/:_authToken=${{ secrets.NPM_TOKEN }}" > .npmrc

            -   name: 'Publishing package'
                run: npm publish --no-git-checks --access public
